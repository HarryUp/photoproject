{% extends 'layout.html' %}

{% block head %}
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
    <style type="text/css">
      html { height: 100% }
      body { height: 100%; margin: 100; padding: 50; }
      #map-canvas { height: 555px; width: 777px; }
    </style>

    <script type="text/javascript"
      src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDC_M1BWtN62aRUFVduggenGNTLF3pqSKk&sensor=true">
    </script>


    <script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.0/jquery.min.js"></script>
    <script src="//ajax.googleapis.com/ajax/libs/jqueryui/1.10.2/jquery-ui.min.js"></script>
    <script src="http://google-maps-utility-library-v3.googlecode.com/svn/trunk/infobubble/src/infobubble.js"></script>
    <script type="text/javascript">
      //create a single infoBubble that will be shared among the markers
      var infoBubble;
      
      function init() {
         var styles = [
    {
      stylers: [
        { hue: "#00ffe6" },
        { saturation: -44 }
      ]
    },{
      featureType: "road",
      elementType: "geometry",
      stylers: [
        { lightness: 100 },
        { visibility: "off" }
      ]
    },{
      featureType: "road",
      elementType: "labels",
      stylers: [
        { visibility: "off" }
      ]
    },{
      featureType: "water",
      stylers: [
        {color: "#7fc8ed"},
        { visibility: "on" }
      ]
    },{
        elementType: "labels",
            stylers: [{
            visibility: "off"
        }]
    },{
      featureType: "landscape",
      stylers: [
        {color: "#2ECC71"},
        { visibility: "on" }
      ]  
}

  ];

  var styledMap = new google.maps.StyledMapType(styles,
    {name: "Styled Map"});


        var mapOptions = {
          center: new google.maps.LatLng(37.463, 122.255),
          zoom: 2,

mapTypeControlOptions: {
      mapTypeIds: [google.maps.MapTypeId.ROADMAP, 'map_style']}

        };
        map = new google.maps.Map(document.getElementById("map-canvas"), mapOptions);

        map.mapTypes.set('map_style', styledMap);
  map.setMapTypeId('map_style');

        {% for photo in photos %}

          var latlng{{photo.id}} = new google.maps.LatLng({{photo.latitude}}, {{photo.longitude}});
          var content{{photo.id}} = '<div><img src="{{photo.thumbnail}}"><p>{{photo.caption}}</p></div>';
          // create a marker
          createMarker("marker{{photo.id}}", latlng{{photo.id}}, content{{photo.id}});

        {% endfor %}

      }

  function createMarker(name, latlng, content) {
    //creates all the markers in the for loop
    var marker = new google.maps.Marker({
      position: latlng,
      map: map,
      draggable:true,
      animation: google.maps.Animation.DROP
    });
    google.maps.event.addListener(marker, "mouseover", function() {
      // if an info window exists close it, this function is called whenever mouseover a different marker
      //only called when the mouseover event happens - dynamic
      if (infoBubble) infoBubble.close();
      infoBubble = new InfoBubble({content: content, maxWidth: 300});
      infoBubble.open(map, marker);
    });
  }

      google.maps.event.addDomListener(window, 'load', init);
      google.maps.event.trigger(map, "resize");

    </script>
 
{% endblock %}

{% block body %}

<div id="map-canvas" ></div>

{% endblock %}